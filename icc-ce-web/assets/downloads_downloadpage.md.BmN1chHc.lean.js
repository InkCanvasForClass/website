import{_ as R,v as S,c as j,o as F,j as e,a as w}from"./chunks/framework.BLyR67qL.js";const V=JSON.parse('{"title":"InkCanvasForClass","description":"","frontmatter":{},"headers":[],"relativePath":"downloads/downloadpage.md","filePath":"downloads/downloadpage.md","lastUpdated":1758361904000}'),L={name:"downloads/downloadpage.md"},z=Object.assign(L,{setup(G){let p=!1,i=null,b=[],g=[],h=!1,d=5,r=null;const v="https://get.smart-teach.cn",_="/d/Ningbo-S3/shared/jiangling/community",T="/d/Ningbo-S3/shared/jiangling/community-beta",$="InkCanvasForClass/community",C="InkCanvasForClass/community-beta",m="https://api.github.com/repos/",k=["https://gh.llkk.cc","https://ghfile.geekertao.top","https://gh.dpik.top","https://github.dpik.top","https://github.acmsz.top","https://git.yylx.win"];function I(t){const a=new Set;return i&&a.add(`${i}/${m}${t}`),a.add(`${m}${t}`),k.forEach(o=>a.add(`${o}/${m}${t}`)),Array.from(a)}async function E(){try{const t=`${v}${_}/test.txt`,a=new AbortController,o=setTimeout(()=>a.abort(),3e3),s=await fetch(t,{method:"HEAD",signal:a.signal,cache:"no-store"});return clearTimeout(o),s.status===200||s.status<400}catch{return!1}}function U(t,a){if(t.endsWith(".exe"))return i?t.replace("https://github.com/",`${i}/https://github.com/`):t;if(p){const o=t.split("/").pop();return`${v}${a?T:_}/${o}`}return i?t.replace("https://github.com/",`${i}/https://github.com/`):t}async function M(t,a="获取数据失败"){for(const o of t)try{const s=await fetch(o,{cache:"no-store"});if(s.ok)return await s.json();console.log(`尝试镜像失败: ${o}, 状态码: ${s.status}`)}catch(s){console.log(`尝试镜像失败: ${o}, 错误: ${s.message}`)}return null}async function x(){const t=`${$}/releases/latest`,a=[`${m}${t}`,...k.map(n=>`${n}/${m}${t}`)],s=(await Promise.all(a.map(n=>new Promise(l=>{const y=performance.now(),u=new AbortController,f=setTimeout(()=>u.abort(),3e3);fetch(n,{method:"HEAD",cache:"no-store",signal:u.signal}).then(()=>{const c=performance.now()-y;l({url:n,timeTaken:c})}).catch(()=>l({url:n,timeTaken:1/0})).finally(()=>clearTimeout(f))})))).filter(n=>n.timeTaken!==1/0).sort((n,l)=>n.timeTaken-l.timeTaken);if(s.length>0){const l=s[0].url.match(/^(https:\/\/[^/]+)/);return l?l[1]:null}return null}function A(t){return new Date(t).toLocaleDateString()}function D(t){return t?t.replace(/\n/g,"<br>"):'<p class="card-subtitle">没有提供更新日志。</p>'}function N(t){const a=t._isBeta||!1,o=a?'<div class="chip chip--small">测试版</div>':'<div class="chip chip--small" style="background-color: var(--md-sys-color-primary-container); color: var(--md-sys-color-on-primary-container);">正式版</div>',s=t.assets.length>0?t.assets.map(n=>`<button class="btn btn--tonal download-btn" onclick="showDownloadModal('${n.browser_download_url}', ${a}, '${n.name}', ${n.size})">
        <span class="material-symbols-outlined">download</span>
        <span>${n.name} (${(n.size/1024/1024).toFixed(2)} MB)</span>
      </button>`).join(""):'<p class="typescale-body-medium card-subtitle">无可用附件</p>';return`
    <article class="release-item card card--filled">
      <header class="release-item-header">
        <a href="${t.html_url}" target="_blank" class="typescale-title-large" style="text-decoration: underline;">${t.name||t.tag_name}</a>
        <div style="display: flex; align-items: center; gap: 1rem; flex-shrink: 0;">
          <span class="typescale-body-medium card-subtitle">${A(t.published_at)}</span>
          ${o}
        </div>
      </header>
      <div class="markdown-body card-subtitle">${D(t.body)}</div>
      <div class="divider"></div>
      <h4 class="typescale-title-medium" style="margin-bottom: 0.75rem;">附件</h4>
      <footer class="release-item-actions">
        ${s}
      </footer>
    </article>
  `}function B(){const t=document.getElementById("release-list"),o=(h?[...b.map(s=>({...s,_isBeta:!1})),...g.map(s=>({...s,_isBeta:!0}))]:b).sort((s,n)=>new Date(n.published_at)-new Date(s.published_at));t.innerHTML=o.map(N).join("")}function P(t,a,o,s){const n=U(t,a);d=5;const l=document.getElementById("downloadModal"),y=document.getElementById("manual-download"),u=document.getElementById("countdown"),f=document.getElementById("manual-download-tip");y.href=n,u.textContent=d,f.style.display="none",l.showModal(),r&&clearInterval(r),r=setInterval(()=>{if(d--,u.textContent=d,d<=0){clearInterval(r);const c=document.createElement("a");c.href=n,c.download="",c.style.display="none",document.body.appendChild(c),c.click(),document.body.removeChild(c),f.style.display="block"}},1e3)}function H(){r&&clearInterval(r),document.getElementById("downloadModal").close()}async function O(){h=!h;const t=document.getElementById("release-loading"),a=document.getElementById("release-list");if(t.style.display="flex",a.style.display="none",h&&g.length===0){const o=I(`${C}/releases`);g=await M(o,"Beta 版本获取失败")||[]}t.style.display="none",a.style.display="grid",B()}return S(async()=>{p=await E(),console.log(`智教镜像源可用: ${p}`),p||(i=await x(),console.log(`最快GitHub镜像源: ${i||"无"}`));const t=I(`${$}/releases`);b=await M(t,"正式版本获取失败")||[],B()}),window.toggleBeta=O,window.showDownloadModal=P,window.closeModal=H,(t,a)=>(F(),j("div",null,[...a[0]||(a[0]=[e("h1",{id:"inkcanvasforclass",tabindex:"-1"},[w("InkCanvasForClass "),e("a",{class:"header-anchor",href:"#inkcanvasforclass","aria-label":'Permalink to "InkCanvasForClass"'},"​")],-1),e("p",null,"这是下载中心页面，你可以在这里获取最新版本的软件。",-1),e("div",{class:"status-chips"},[e("div",{class:"status-chip smart-teach-chip"},[e("span",{class:"material-symbols-outlined"},"school"),e("span",null,"智教镜像可用")]),e("button",{class:"btn btn--tonal toggle-beta-btn",onclick:"toggleBeta()"},[e("span",{class:"material-symbols-outlined"},"science"),e("span",null,"显示测试版")])],-1),e("div",{id:"release-loading",class:"release-loading",style:{display:"none"}},[e("div",{class:"loader"}),e("p",null,"正在加载...")],-1),e("div",{id:"release-list",class:"release-grid"},null,-1),e("dialog",{class:"modal",id:"downloadModal"},[e("div",{class:"modal-content"},[e("div",{class:"modal-header"},[e("h3",null,"正在为您准备下载..."),e("button",{class:"btn btn--icon",onclick:"closeModal()"},[e("span",{class:"material-symbols-outlined"},"close")])]),e("div",{class:"modal-body"},[e("p",{id:"thank-you-text"},"感谢您下载 InkCanvasforClass-Community"),e("div",{class:"countdown-container"},[e("p",null,[w("将在 "),e("span",{id:"countdown",class:"countdown-number"},"5"),w(" 秒后自动下载。")])]),e("div",{class:"btn-group"},[e("a",{id:"manual-download",class:"btn btn--filled",href:"#"}," 单击此处下载 "),e("a",{href:"https://inkcanvasforclass.github.io/website",target:"_blank",class:"btn btn--text"},[e("span",{class:"material-symbols-outlined"},"menu_book"),e("span",null,"查看使用文档")])]),e("p",{id:"manual-download-tip",class:"manual-download-tip",style:{display:"none"}},"如果自动下载未开始，请点击上方链接。")]),e("div",{class:"modal-actions"},[e("button",{class:"btn btn--text",onclick:"closeModal()"},"关闭")])])],-1)])]))}}),W=R(z,[["__scopeId","data-v-8fed3b44"]]);export{V as __pageData,W as default};
